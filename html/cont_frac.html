<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-04-05 Tue 07:03 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>&lrm;</title>
<meta name="author" content="Hsin-Hao Yu" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
</style>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "left",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content" class="content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org59256f9">1. Continued fraction representations of rational numbers</a></li>
<li><a href="#org490ffc0">2. Convergents</a></li>
<li><a href="#org2091432">3. Continued fraction approximation as function compositions</a></li>
<li><a href="#org093e82d">4. Convergents: matrix formulation</a></li>
<li><a href="#orgef041e4">5. Simple transformations of continued fractions</a></li>
<li><a href="#orgdd9bb3d">6. Appendix: Tabulated displays</a></li>
<li><a href="#org6f1292d">7. Appendix: LaTeX utilities</a></li>
<li><a href="#org46cc4e8">8. Appendix: imports</a></li>
</ul>
</div>
</div>
<div id="outline-container-org59256f9" class="outline-2">
<h2 id="org59256f9"><span class="section-number-2">1.</span> Continued fraction representations of rational numbers</h2>
<div class="outline-text-2" id="text-1">
<p>
Since we'll use rational numbers a lot, let's define a class:
</p>
<div class="org-src-container">
<pre class="src src-python">&lt;&lt;IMPORTS&gt;&gt;
<span class="org-comment-delimiter"># </span><span class="org-comment">Rational(a, b) = a/b</span>
<span class="org-keyword">class</span> <span class="org-type">Rational</span>(NamedTuple(<span class="org-string">'Rational'</span>, [(<span class="org-string">'a'</span>, <span class="org-builtin">int</span>), (<span class="org-string">'b'</span>, <span class="org-builtin">int</span>)])):
    <span class="org-keyword">def</span> <span class="org-function-name">__repr__</span>(<span class="org-keyword">self</span>):
        <span class="org-keyword">return</span> f<span class="org-string">'{self.a}/{self.b}'</span>
</pre>
</div>

<p>
How to convert a rational number to a continued fraction? Observe that
</p>

<p>
\[
\frac{254}{100}
= 2 + \frac{54}{100}
= 2 + \frac{1}{\frac{100}{54}}
= 2 + \frac{1}{1 + \frac{46}{54}}
= 2 + \frac{1}{1 + \frac{1}{\frac{46}{54}}}
\]
</p>

<p>
It should be obvious that the solution is similar to the Euclidean algorithm for finding the greatest common divider:
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">def</span> <span class="org-function-name">euclid</span>(a: <span class="org-builtin">int</span>, b: <span class="org-builtin">int</span>) -&gt; Tuple[<span class="org-builtin">int</span>, <span class="org-builtin">int</span>]:
    <span class="org-doc">"""a = b * q + r"""</span>
    <span class="org-variable-name">q</span> = math.floor(a / b)
    <span class="org-variable-name">r</span> = a - b * q
    <span class="org-keyword">return</span> (q, r)

<span class="org-keyword">def</span> <span class="org-function-name">r2cf_</span>(rn: Rational) -&gt; Iterator[Tuple[<span class="org-builtin">int</span>, <span class="org-builtin">int</span>]]:
    <span class="org-variable-name">a</span>, <span class="org-variable-name">b</span> = rn    
    <span class="org-variable-name">r</span> = 1000
    <span class="org-keyword">while</span> r != 0:
        <span class="org-variable-name">q</span>, <span class="org-variable-name">r</span> = euclid(a, b)
        <span class="org-keyword">yield</span> b, q
        <span class="org-variable-name">a</span> = b
        <span class="org-variable-name">b</span> = r

<span class="org-keyword">def</span> <span class="org-function-name">r2cf</span>(rn: Rational) -&gt; Iterator[<span class="org-builtin">int</span>]:
    <span class="org-keyword">def</span> <span class="org-function-name">second</span>(x: <span class="org-builtin">tuple</span>):
        <span class="org-keyword">return</span> x[1]
    <span class="org-keyword">return</span> <span class="org-builtin">map</span>(second, r2cf_(rn))
</pre>
</div>

<p>
Now we can use <code>r2cf</code> to calculate the coefficients. I use a generator to represent the returned coefficients, because continued fractions can have infinite number of terms. However, the continuous fraction representations of rational numbers are always finite.
</p>
<div class="org-src-container">
<pre class="src src-python">&lt;&lt;DEMO_IMPORTS&gt;&gt;
<span class="org-variable-name">nc</span> = r2cf(Rational(254, 100))
<span class="org-keyword">print</span>(<span class="org-builtin">list</span>(nc))
</pre>
</div>

<pre class="example">
[2, 1, 1, 5, 1, 3]
</pre>


<p>
This means that
\[
\frac{ 254 }{ 100 }=
2+\frac{1}{1+\frac{1}{1+\frac{1}{5+\frac{1}{1+\frac{1}{3}}}}}
\]
</p>

<p>
We can display the process in a tabular format. For example:
</p>
<div class="org-src-container">
<pre class="src src-python">&lt;&lt;DEMO_IMPORTS&gt;&gt;
<span class="org-keyword">print</span>(r2cf_tab(Rational(254, 100)))
</pre>
</div>

<pre class="example">
254
100   2   
 54   1   
 46   1   
  8   5   
  6   1   
  2   3   
  0

</pre>


<p>
Interestingly, the reciprocal of \(\frac{254}{100}\) (that is, \(\frac{100}{254}\)) is represented by the following as a continued fraction:
</p>
<div class="org-src-container">
<pre class="src src-python">&lt;&lt;DEMO_IMPORTS&gt;&gt;
<span class="org-variable-name">nc</span> = r2cf(Rational(100, 254))
<span class="org-keyword">print</span>(<span class="org-builtin">list</span>(nc))
</pre>
</div>

<pre class="example">
[0, 2, 1, 1, 5, 1, 3]
</pre>


<p>
It's the same sequence with an additional 0 at the beginning! This is our first clue that a continued fraction can be transformed by performing some operations at the beginning of the <code>r2cf</code> process.
</p>

<p>
However, it's not obvious how to perform algebraically meaningful transformations. For example, if we multiple the rational number by two, the continued fraction series appear to be quite different. It's not clear how we get [0, 1, 3, 1, 2, 2, 1, 2] from [0, 2, 1, 1, 5, 1, 3]. We'll come back to this question a little bit later. 
</p>
<div class="org-src-container">
<pre class="src src-python">&lt;&lt;DEMO_IMPORTS&gt;&gt;
<span class="org-keyword">print</span>(<span class="org-builtin">list</span>(r2cf(Rational(200, 254))))
</pre>
</div>

<pre class="example">
[0, 1, 3, 1, 2, 2, 1, 2]
</pre>
</div>
</div>

<div id="outline-container-org490ffc0" class="outline-2">
<h2 id="org490ffc0"><span class="section-number-2">2.</span> Convergents</h2>
<div class="outline-text-2" id="text-2">
<p>
Given a continued fraction, how do we calculate the value? If the series is finite, we can easily write a recursive function. However, if it's an infinite series, we need a method to incrementally approximate the value as more coefficients are received. Also, we want the evaluation to be accumulative, so that each update is based on the previous one.
</p>

<p>
This question has an easy solution if we use rational numbers in the approximation. Such a series is called a convergent. The formula can be easily derived with mathematical induction, and it is implemented below. For the moment, we'll see it just a convenience to get the job done. We'll get deeper into its meaning in the next section.
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">def</span> <span class="org-function-name">cf_convergent0</span>(cf: Iterator[<span class="org-builtin">int</span>]) -&gt; Iterator[Rational]:
    <span class="org-variable-name">p1</span>, <span class="org-variable-name">p0</span> = 1, 0
    <span class="org-variable-name">q1</span>, <span class="org-variable-name">q0</span> = 0, 1

    <span class="org-keyword">for</span> a <span class="org-keyword">in</span> cf:
        <span class="org-variable-name">p</span> = a * p1 + p0
        <span class="org-variable-name">q</span> = a * q1 + q0
        <span class="org-keyword">yield</span> Rational(p, q)

        <span class="org-variable-name">p0</span>, <span class="org-variable-name">p1</span> = p1, p
        <span class="org-variable-name">q0</span>, <span class="org-variable-name">q1</span> = q1, q
</pre>
</div>

<p>
For example, for the continued fraction \(2, 1, 1, 5, 1, 3\), we get
</p>
<div class="org-src-container">
<pre class="src src-python">&lt;&lt;DEMO_IMPORTS&gt;&gt;
<span class="org-keyword">print</span>(<span class="org-builtin">list</span>(cf_convergent0(<span class="org-builtin">iter</span>([2, 1, 1, 5, 1, 3]))))
</pre>
</div>

<pre class="example">
[2/1, 3/1, 5/2, 28/11, 33/13, 127/50]
</pre>


<p>
In other words, 
\(2+\frac{1}{1+\frac{1}{1+\frac{1}{5+\frac{1}{1+\frac{1}{3}}}}}\)
can be approximated with
\(\frac{2}{1}\),\(\frac{3}{1}\),\(\frac{5}{2}\),\(\frac{28}{11}\),\(\frac{33}{13}\),\(\frac{127}{50}\)
.
</p>
</div>
</div>

<div id="outline-container-org2091432" class="outline-2">
<h2 id="org2091432"><span class="section-number-2">3.</span> Continued fraction approximation as function compositions</h2>
<div class="outline-text-2" id="text-3">
<p>
Given the first 3 terms in a continued fraction [5, 1, 4&#x2026;], let \(x\) denote the reciprocal of the value of the remaining series. We can express the convergent as \(f_1(x)\), \(f_2(x)\), \(f_3(x)\)&#x2026;, where
</p>

\begin{equation*}
    f_1(x) = 5 + \frac{1}{x}
\end{equation*}

\begin{equation*}
    f_2(x) = 5 + \frac{1}{1 + \frac{1}{x}} = f_1(1 + \frac{1}{x})
\end{equation*}

\begin{equation*}
    f_3(x) = 5 + \frac{1}{1 + \frac{1}{4 + \frac{1}{x}}} = f_1(f_2(4 + \frac{1}{x}))
\end{equation*}

<p>
Or more compactly, let
</p>
\begin{equation*}
    h(a, x) = a + \frac{1}{x}
\end{equation*}

<p>
then
</p>
\begin{equation*}
    f_1(x) = h(5, x)
\end{equation*}

\begin{equation*}
    f_2(x) = h(5, h(1, x))
\end{equation*}

\begin{equation*}
    f_3(x) = h(5, h(1, h(4, x))) 
\end{equation*}

<p>
This way, we express the approximation as a recursive process. If the continued fraction stops at the third term, its value is \(h_3(\infty) = h(5, h(1, h(4, \infty)))\). Infinity might seem odd, but remember that \(x\) is the reciprocal of the rest of the sequence. So it just means that the rest of the sequence evaluates to 0.
</p>

<p>
Before we rush to translate this into code, but let's dig deeper. If we use column vectors to represent rational numbers:
</p>

\begin{equation*}
    \begin{bmatrix}
           p \\
           q
    \end{bmatrix} = \frac{p}{q}
\end{equation*}

<p>
Then we can turn everything into linear algebra:
</p>

\begin{equation*}
    h(a, x) = a + \frac{1}{x} = \frac{ax + 1}{x} =

    \begin{bmatrix}
        ax + 1 \\
        x
    \end{bmatrix}

    =

    \begin{bmatrix}
        a & 1 \\
        1 & 0
    \end{bmatrix}

    \begin{bmatrix}
        x \\
        1 
    \end{bmatrix}
\end{equation*}

<p>
Furthermore, 
</p>

\begin{equation*}
    f_3(x) = h(5, h(1, h(4, x))) =

    \begin{bmatrix}
        5 & 1 \\
        1 & 0
    \end{bmatrix}

    \begin{bmatrix}
        1 & 1 \\
        1 & 0
    \end{bmatrix}

    \begin{bmatrix}
        4 & 1 \\
        1 & 0
    \end{bmatrix}

    \begin{bmatrix}
        x \\
        1 
    \end{bmatrix}

    = 

    \begin{bmatrix}
        29 & 6 \\
        5 & 1
    \end{bmatrix}

    \begin{bmatrix}
        x \\
        1 
    \end{bmatrix}

\end{equation*}

<p>
So, the 2-by-2 matrix
</p>

<p>
\(\begin{bmatrix}
    29 & 6 \\
     5 & 1
\end{bmatrix}\)
</p>

<p>
is a function that represents an approximation of a continued fraction with more terms. Applying this function to the remains of the series gives the exact value of the continued fraction. If continued fractions has only 3 terms, we terminate the process by evaluating
</p>

\begin{equation*}
    f_3(
        \begin{bmatrix}
            1 \\
            0
        \end{bmatrix}
    ) = 

    \begin{bmatrix}
        29 & 6 \\
         5 & 1
    \end{bmatrix}

    \begin{bmatrix}
        1 \\
        0 
    \end{bmatrix}

    = 

    \begin{bmatrix}
        29 \\
         5
    \end{bmatrix}

    = \frac{29}{5}
\end{equation*}
<p>
.
</p>

<p>
Applying \(f_3(x)\) to
\(\begin{bmatrix}
    1 \\
    0 
\end{bmatrix}\) turns the function into a rational value, by taking the first column of the matrix.
</p>
</div>
</div>

<div id="outline-container-org093e82d" class="outline-2">
<h2 id="org093e82d"><span class="section-number-2">4.</span> Convergents: matrix formulation</h2>
<div class="outline-text-2" id="text-4">
<p>
Now, we are ready to rewrite the formula in <code>cf_convergence0</code> as matrix multiplications:
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">def</span> <span class="org-function-name">h</span>(a):
    <span class="org-keyword">return</span> np.array([[a, 1], [1,0]])

<span class="org-keyword">def</span> <span class="org-function-name">cf_convergent1_</span>(cdf: Iterator[<span class="org-builtin">int</span>]) -&gt; Iterator:
    <span class="org-variable-name">res</span> = np.array([[1, 0], [0, 1]])
    <span class="org-keyword">for</span> a <span class="org-keyword">in</span> cdf:
        <span class="org-variable-name">res</span> = np.matmul(res, h(a))
        <span class="org-keyword">yield</span> res

<span class="org-keyword">def</span> <span class="org-function-name">cf_convergent1</span>(cdf: Iterator[<span class="org-builtin">int</span>]) -&gt; Iterator[Rational]:
    <span class="org-variable-name">mLst</span> = cf_convergent1_(cdf)
    <span class="org-keyword">for</span> m <span class="org-keyword">in</span> mLst:
        <span class="org-keyword">yield</span> Rational(m[0, 0], m[1, 0])
</pre>
</div>

<p>
Let's try it on the example given in the previous section:
</p>
<div class="org-src-container">
<pre class="src src-python">&lt;&lt;DEMO_IMPORTS&gt;&gt;
<span class="org-keyword">print</span>(<span class="org-builtin">list</span>(cf_convergent1(<span class="org-builtin">iter</span>([5, 1, 4]))))
</pre>
</div>

<pre class="example">
[5/1, 6/1, 29/5]
</pre>


<p>
Here's a longer sequence that we used previously:
</p>
<div class="org-src-container">
<pre class="src src-python">&lt;&lt;DEMO_IMPORTS&gt;&gt;
<span class="org-keyword">print</span>(<span class="org-builtin">list</span>(cf_convergent1(<span class="org-builtin">iter</span>([2, 1, 1, 5, 1, 3]))))
</pre>
</div>

<pre class="example">
[2/1, 3/1, 5/2, 28/11, 33/13, 127/50]
</pre>


<p>
A very charming thing that Gosper did was that he used a compact tabulated format to illustrate the process. It's unnecessary for the computation, but I think it looks pretty cool:
</p>
<div class="org-src-container">
<pre class="src src-python">&lt;&lt;DEMO_IMPORTS&gt;&gt;
cf_convergent1_tab(<span class="org-builtin">iter</span>([5, 1, 4]))
</pre>
</div>

<pre class="example">
     4   1   5
29   6   5   1   0
 5   1   1   0   1
</pre>



<p>
This table is read from the right to the left. The direction is unnatural, but it's needed to preserve the normal representation of matrices. The first row represents the continued fraction.
</p>

<p>
We can calculate the matrices for each addition term in the continued fraction:
</p>
<div class="org-src-container">
<pre class="src src-python">&lt;&lt;DEMO_IMPORTS&gt;&gt;
<span class="org-variable-name">itr</span> = cf_convergent1_(<span class="org-builtin">iter</span>([5, 1, 4]))
<span class="org-keyword">print</span>(<span class="org-builtin">next</span>(itr),<span class="org-string">"\n"</span>)
<span class="org-keyword">print</span>(<span class="org-builtin">next</span>(itr),<span class="org-string">"\n"</span>)
<span class="org-keyword">print</span>(<span class="org-builtin">next</span>(itr))
</pre>
</div>

<pre class="example">
[[5 1]
 [1 0]] 

[[6 5]
 [1 1]] 

[[29  6]
 [ 5  1]]
</pre>


<p>
We can see that the matrices shift leftwards in the table above. Interpreting columns as rational numbers, we can read the convergent one by one off the table: \(\frac{5}{1}\), \(\frac{6}{1}\), and \(\frac{29}{5}\).
</p>

<p>
Here's a longer example:
</p>
<div class="org-src-container">
<pre class="src src-python">&lt;&lt;DEMO_IMPORTS&gt;&gt;
cf_convergent1_tab(<span class="org-builtin">iter</span>([2, 1, 1, 5, 1, 3]))
</pre>
</div>

<pre class="example">
      3   1   5   1   1   2
127  33  28   5   3   2   1   0
 50  13  11   2   1   1   0   1
</pre>
</div>
</div>

<div id="outline-container-orgef041e4" class="outline-2">
<h2 id="orgef041e4"><span class="section-number-2">5.</span> Simple transformations of continued fractions</h2>
<div class="outline-text-2" id="text-5">
<p>
Recall that we started this article by describing a recursive algorithm for converting a rational number into a continued fraction. Then we developed a recursive algorithm for approximating a continued fraction by a series of rational numbers. Now, we'll combine these two ideas.
</p>

<p>
Recall that in a previous example, we express the third term in the convergent of [5, 1, 4&#x2026;] as
</p>

\begin{equation*}
    f_3(x) =
    \begin{bmatrix}
        29 & 6 \\
        5 & 1
    \end{bmatrix}

    \begin{bmatrix}
        x \\
        1 
    \end{bmatrix} =
    \frac{29x + 6}{5x + 1}
\end{equation*}

<p>
Observe that
</p>
\begin{equation*}
    f_3(x) =
    \begin{bmatrix}
        29 & 6 \\
        5 & 1
    \end{bmatrix}

    \begin{bmatrix}
        x \\
        1 
    \end{bmatrix} =
    \frac{29x + 6}{5x + 1}
\end{equation*}




<p>
In the previous section, we start with a continued fraction \(a\) represented as \([a_1, a_2, ...]\), and use matrix multiplication to calculate an rational series to approximate it. What if \(a\) is embedded in another expression? Let \(b=2a\). 
</p>
</div>
</div>

<div id="outline-container-orgdd9bb3d" class="outline-2">
<h2 id="orgdd9bb3d"><span class="section-number-2">6.</span> Appendix: Tabulated displays</h2>
<div class="outline-text-2" id="text-6">
<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">def</span> <span class="org-function-name">r2cf_tab</span>(rn: Rational):
    <span class="org-keyword">def</span> <span class="org-function-name">row</span>(st: <span class="org-builtin">str</span>, x: <span class="org-builtin">tuple</span>):
        <span class="org-variable-name">b</span>, <span class="org-variable-name">q</span> = x
        <span class="org-keyword">return</span> st + f<span class="org-string">"{b : &gt; 5}  {q : &lt; 5}\n"</span>
    <span class="org-variable-name">str0</span> = f<span class="org-string">"{rn.a : &gt; 5}\n"</span>
    <span class="org-keyword">return</span> <span class="org-builtin">reduce</span>(row, r2cf_(rn), str0) + f<span class="org-string">"{0 : &gt; 5}\n"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">def</span> <span class="org-function-name">cf_convergent1_tab_pp</span>(row1, row2, row3):
    <span class="org-keyword">def</span> <span class="org-function-name">f_</span>(item):
        <span class="org-keyword">if</span> item <span class="org-keyword">is</span> <span class="org-constant">None</span>:
            <span class="org-keyword">return</span> f<span class="org-string">"{'': &gt;4}"</span>
        <span class="org-keyword">else</span>:
            <span class="org-keyword">return</span> f<span class="org-string">"{item: &gt;4}"</span>

    <span class="org-keyword">print</span>(<span class="org-builtin">reduce</span>(<span class="org-keyword">lambda</span> a, b: a + b, <span class="org-builtin">map</span>(f_, row1), <span class="org-string">""</span>))
    <span class="org-keyword">print</span>(<span class="org-builtin">reduce</span>(<span class="org-keyword">lambda</span> a, b: a + b, <span class="org-builtin">map</span>(f_, row2), <span class="org-string">""</span>))
    <span class="org-keyword">print</span>(<span class="org-builtin">reduce</span>(<span class="org-keyword">lambda</span> a, b: a + b, <span class="org-builtin">map</span>(f_, row3), <span class="org-string">""</span>))    

<span class="org-keyword">def</span> <span class="org-function-name">cf_convergent1_tab</span>(cf: Iterator[<span class="org-builtin">int</span>]):
    <span class="org-variable-name">row1</span>, <span class="org-variable-name">row2</span>, <span class="org-variable-name">row3</span> = [], [], []
    <span class="org-variable-name">row2</span> = [0, 1]
    <span class="org-variable-name">row3</span> = [1, 0]

    (cf1, cf2) = tee(cf)
    <span class="org-keyword">for</span> (mat, a) <span class="org-keyword">in</span> <span class="org-builtin">zip</span>(cf_convergent1_(cf1), cf2):
        row1.append(a)
        row2.append(mat[0][0])
        row3.append(mat[1][0])

    row1.reverse()
    row2.reverse()
    row3.reverse()

    <span class="org-variable-name">row1</span> = [<span class="org-constant">None</span>] + row1
    cf_convergent1_tab_pp(row1, row2, row3)
</pre>
</div>
</div>
</div>

<div id="outline-container-org6f1292d" class="outline-2">
<h2 id="org6f1292d"><span class="section-number-2">7.</span> Appendix: LaTeX utilities</h2>
<div class="outline-text-2" id="text-7">
<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">def</span> <span class="org-function-name">latex_cf</span>(lst: <span class="org-builtin">list</span>):
    <span class="org-keyword">if</span> <span class="org-builtin">len</span>(lst) == 1:
        <span class="org-keyword">return</span> <span class="org-builtin">str</span>(lst[0])
    <span class="org-keyword">else</span>:
        <span class="org-variable-name">x</span> = <span class="org-builtin">str</span>(lst[0]) + <span class="org-string">"+"</span>
        <span class="org-variable-name">x</span> = x + r<span class="org-string">"\frac{1}{"</span> + latex_cf(lst[1:]) + <span class="org-string">"}"</span>
        <span class="org-keyword">return</span> x

<span class="org-keyword">def</span> <span class="org-function-name">latex_rational</span>(r: Rational):
    <span class="org-keyword">return</span> r<span class="org-string">"\frac{"</span> + <span class="org-builtin">str</span>(r.a) + <span class="org-string">"}{"</span> + <span class="org-builtin">str</span>(r.b) + <span class="org-string">"}"</span>

<span class="org-keyword">def</span> <span class="org-function-name">show_cf_expansion</span>(r: Rational):
    <span class="org-keyword">print</span>(r<span class="org-string">"\["</span>)
    <span class="org-keyword">print</span>(r<span class="org-string">"\frac{"</span>, r.a, <span class="org-string">"}{"</span>, r.b, <span class="org-string">"}="</span>)
    <span class="org-variable-name">nc</span> = <span class="org-builtin">list</span>(r2cf(r))
    <span class="org-keyword">print</span>(latex_cf(nc))
    <span class="org-keyword">print</span>(r<span class="org-string">"\]"</span>)

<span class="org-keyword">def</span> <span class="org-function-name">show_rational_series</span>(itr: Iterator[<span class="org-builtin">int</span>]):
    <span class="org-variable-name">rLst</span> = <span class="org-builtin">list</span>(cf_convergent0(itr))
    <span class="org-variable-name">s</span> = <span class="org-string">""</span>
    <span class="org-keyword">for</span> r <span class="org-keyword">in</span> rLst:
        <span class="org-variable-name">s</span> = s + <span class="org-string">"$"</span> + latex_rational(r) + <span class="org-string">"$"</span> + <span class="org-string">","</span>

    <span class="org-keyword">print</span>(s[:-1])
</pre>
</div>
</div>
</div>

<div id="outline-container-org46cc4e8" class="outline-2">
<h2 id="org46cc4e8"><span class="section-number-2">8.</span> Appendix: imports</h2>
<div class="outline-text-2" id="text-8">
<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">import</span> math
<span class="org-keyword">import</span> numpy <span class="org-keyword">as</span> np
<span class="org-keyword">from</span> typing <span class="org-keyword">import</span> NamedTuple, Iterator, Tuple
<span class="org-keyword">from</span> functools <span class="org-keyword">import</span> <span class="org-builtin">reduce</span>
<span class="org-keyword">from</span> itertools <span class="org-keyword">import</span> tee
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">from</span> cont_frac <span class="org-keyword">import</span> *
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Hsin-Hao Yu</p>
<p class="date">Created: 2022-04-05 Tue 07:03</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
